<app-container>
  <app-page-header
    title="DISCLAIMER: Refer to the read me for how the top navbar should look if you're authenticated"
  ></app-page-header>
  <app-page-header
    title="صفحة عرض المكونات - PIFSS Template Showcase"
  ></app-page-header>

  <!-- Toast Examples -->
  <app-card>
    <div class="p-6 mb-6">
      <h2 class="text-xl font-bold mb-4 text-gray-800">
        التنبيهات - Toast Notifications
      </h2>

      <div class="flex gap-4 flex-wrap">
        <app-button
          text="عرض رسالة نجاح"
          (btnClick)="toastService.showSuccess('تمت العملية بنجاح')"
          variant="primary"
          [showIcon]="false"
        ></app-button>

        <app-button
          text="عرض رسالة خطأ"
          (btnClick)="toastService.showError('حدث خطأ في العملية')"
          variant="secondary"
          [showIcon]="false"
        ></app-button>

        <app-button
          text="عرض أمثلة متعددة"
          (btnClick)="showToastExamples()"
          variant="secondary"
          [showIcon]="false"
        ></app-button>
      </div>
    </div>
  </app-card>

  <!-- Form Example -->
  <app-card>
    <div class="p-6 mb-6">
      <h2 class="text-xl font-bold mb-4 text-gray-800">
        نموذج البيانات - Data Form
      </h2>

      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Civil ID Field -->
          <app-form-field
            label="الرقم المدني"
            [required]="true"
            hint="أدخل الرقم المدني الكويتي (12 رقم)"
            [showError]="hasError('civilId')"
            [errorMessage]="getErrorMessage('civilId')"
          >
            <app-form-input
              formControlName="civilId"
              type="text"
              placeholder="مثال: 123456789012"
              restriction="civilId"
            ></app-form-input>
          </app-form-field>

          <!-- Name Field -->
          <app-form-field
            label="الاسم الكامل"
            [required]="true"
            [showError]="hasError('fullName')"
            [errorMessage]="getErrorMessage('fullName')"
          >
            <app-form-input
              formControlName="fullName"
              type="text"
              placeholder="أدخل الاسم الكامل"
              restriction="name"
            ></app-form-input>
          </app-form-field>

          <!-- Email Field -->
          <app-form-field
            label="البريد الإلكتروني"
            [required]="true"
            [showError]="hasError('email')"
            [errorMessage]="getErrorMessage('email')"
          >
            <app-form-input
              formControlName="email"
              type="email"
              placeholder="example@pifss.gov.kw"
            ></app-form-input>
          </app-form-field>

          <!-- Department Select -->
          <app-form-field
            label="القسم"
            [required]="true"
            [showError]="hasError('department')"
            [errorMessage]="getErrorMessage('department')"
          >
            <app-form-select-group
              formControlName="department"
              placeholder="اختر القسم"
              [groups]="departmentGroups"
              [showIndex]="true"
            ></app-form-select-group>
          </app-form-field>

          <!-- Start Date -->
          <app-form-field
            label="تاريخ البداية"
            [required]="true"
            [showError]="hasError('startDate')"
            [errorMessage]="getErrorMessage('startDate')"
          >
            <app-date-picker
              formControlName="startDate"
              [maxDate]="today"
            ></app-date-picker>
          </app-form-field>

          <!-- End Date -->
          <app-form-field
            label="تاريخ النهاية"
            [required]="true"
            [showError]="hasError('endDate')"
            [errorMessage]="getErrorMessage('endDate')"
          >
            <app-date-picker
              formControlName="endDate"
              [maxDate]="today"
            ></app-date-picker>
          </app-form-field>

          <!-- Amount Field -->
          <app-form-field
            label="المبلغ (د.ك)"
            [required]="true"
            hint="أدخل المبلغ بالدينار الكويتي"
            [showError]="hasError('amount')"
            [errorMessage]="getErrorMessage('amount')"
          >
            <app-form-input
              formControlName="amount"
              type="text"
              placeholder="0.000"
              restriction="amount"
            ></app-form-input>
          </app-form-field>

          <!-- Combined Phone Field with Country Selection -->
          <app-form-field
            label="رقم الهاتف"
            [required]="true"
            [hint]="getCombinedPhoneHint()"
            [showError]="hasError('phoneCountry') || hasError('phone')"
            [errorMessage]="getCombinedPhoneErrorMessage()"
          >
            <div class="flex gap-2 items-start phone-country-selector">
              <!-- Custom Country Selector styled like a select -->
              <div class="relative">
                <button
                  type="button"
                  (click)="toggleCountryDropdown()"
                  class="h-[42px] w-32 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary bg-white text-right appearance-none flex items-center justify-between hover:bg-gray-50 transition-colors"
                  [class.border-red-500]="hasError('phoneCountry')"
                >
                  @if (getSelectedCountryData(); as country) {
                  <div class="flex items-center gap-2">
                    <img 
                      [src]="country.flagSvg" 
                      [alt]="country.englishName + ' flag'" 
                      class="w-6 h-4 object-cover"
                    />
                    <span class="text-sm text-gray-700 truncate">{{ country.phoneCode }}</span>
                  </div>
                  } @else {
                  <span class="text-sm text-gray-700">اختر الدولة</span>
                  }
                  
                  <!-- Chevron icon positioned like in select -->
                  <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" 
                       fill="none" 
                       stroke="currentColor" 
                       viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </button>

                <!-- Country Dropdown menu -->
                @if (showCountryDropdown()) {
                <div class="absolute z-50 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto">
                  @for (country of gccCountriesList; track country.code) {
                  <button
                    type="button"
                    (click)="selectCountry(country.code)"
                    class="w-full px-3 py-2 text-right hover:bg-gray-50 flex items-center gap-2 transition-colors"
                    [class.bg-primary]="country.code === selectedCountry()"
                    [class.text-white]="country.code === selectedCountry()"
                    [class.hover:bg-primary/90]="country.code === selectedCountry()"
                  >
                    <img 
                      [src]="country.flagSvg" 
                      [alt]="country.englishName + ' flag'" 
                      class="w-6 h-4 object-cover flex-shrink-0"
                    />
                    <span class="flex-1 text-sm">{{ country.arabicName }}</span>
                  </button>
                  }
                </div>
                }
              </div>

              <!-- Phone Number Input -->
              <div class="flex-1">
                <app-form-input
                  formControlName="phone"
                  type="tel"
                  [placeholder]="getPhonePlaceholder()"
                  restriction="gccPhone"
                  [phoneContext]="{ countryCode: selectedCountry() }"
                  dir="ltr"
                  class="text-left"
                ></app-form-input>
              </div>
            </div>
          </app-form-field>
        </div>

        <!-- Notes Field -->
        <app-form-field label="ملاحظات" hint="أدخل أي ملاحظات إضافية">
          <textarea
            formControlName="notes"
            class="form-input-rtl"
            rows="3"
            placeholder="ملاحظات إضافية..."
          ></textarea>
        </app-form-field>

        <!-- Form Actions -->
        <div class="flex gap-4 justify-center pt-4">
          <app-button
            text="إرسال النموذج"
            [loading]="isSubmitting()"
            [disabled]="form.invalid"
            (btnClick)="onSubmit()"
            [showIcon]="true"
            iconType="upload"
          ></app-button>

          <app-button
            text="تنزيل التقرير"
            [loading]="isDownloading()"
            (btnClick)="onDownload()"
            [showIcon]="true"
            iconType="download"
          ></app-button>

          <app-button
            text="إعادة تعيين"
            (btnClick)="onReset()"
            [showIcon]="false"
            variant="secondary"
          ></app-button>
        </div>
      </form>
    </div>
  </app-card>

  <!-- Button Showcase -->
  <app-card class="mb-6">
    <div class="p-6">
      <h2 class="text-xl font-bold mb-4 text-gray-800">الأزرار - Buttons</h2>

      <div class="space-y-4">
        <div class="flex gap-4 flex-wrap">
          <app-button
            text="زر أساسي"
            [loading]="false"
            [showIcon]="false"
          ></app-button>

          <app-button
            text="زر مع أيقونة تحميل"
            [loading]="false"
            [showIcon]="true"
            iconType="download"
          ></app-button>

          <app-button
            text="زر مع أيقونة رفع"
            [loading]="false"
            [showIcon]="true"
            iconType="upload"
          ></app-button>

          <app-button text="جاري التحميل..." [loading]="true"></app-button>

          <app-button text="زر معطل" [disabled]="true"></app-button>
        </div>
      </div>
    </div>
  </app-card>

  <!-- Statistics Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
    <app-card>
      <div class="p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600">إجمالي المستخدمين</p>
            <p class="text-2xl font-bold text-primary">1,234</p>
          </div>
          <svg
            class="w-12 h-12 text-primary opacity-20"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
            />
          </svg>
        </div>
        <p class="text-xs text-green-600 mt-2">↑ 12% من الشهر الماضي</p>
      </div>
    </app-card>

    <app-card>
      <div class="p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600">التقارير المنشأة</p>
            <p class="text-2xl font-bold text-primary">456</p>
          </div>
          <svg
            class="w-12 h-12 text-primary opacity-20"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"
            />
          </svg>
        </div>
        <p class="text-xs text-green-600 mt-2">↑ 8% من الشهر الماضي</p>
      </div>
    </app-card>

    <app-card>
      <div class="p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600">المعاملات المكتملة</p>
            <p class="text-2xl font-bold text-primary">789</p>
          </div>
          <svg
            class="w-12 h-12 text-primary opacity-20"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z" />
          </svg>
        </div>
        <p class="text-xs text-red-600 mt-2">↓ 3% من الشهر الماضي</p>
      </div>
    </app-card>
  </div>
</app-container>